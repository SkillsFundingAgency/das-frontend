var e,t;e=this,t=function(e){function t(e){this.$module=e,this.$sections=e.querySelectorAll(".govuk-accordion__section"),this.$openAllButton=""}function o(e,t){if(window.NodeList.prototype.forEach)return e.forEach(t);for(var o=0;o<e.length;o++)t.call(window,e[o],o,e)}t.prototype.init=function(){var e=this.$module;if(e){this.moduleId=e.getAttribute("id"),o(this.$sections,function(e,t){var o=e.querySelector(".govuk-accordion__section-header");this.setHeaderAttributes(o,t),this.setExpanded(this.isExpanded(e),e),o.addEventListener("click",this.onToggleExpanded.bind(this,e))}.bind(this)),this.$openAllButton=document.createElement("button"),this.setOpenAllButtonAttributes(this.$openAllButton);var t=document.createElement("div");t.setAttribute("class","govuk-accordion__controls"),t.appendChild(this.$openAllButton),this.$module.insertBefore(t,this.$module.firstChild),this.$module.classList.add("with-js"),this.$openAllButton.addEventListener("click",this.openOrCloseAllSections.bind(this)),this.readState();var i=this.checkIfAllSectionsOpen();this.updateOpenAllButton(i)}},t.prototype.onToggleExpanded=function(e){var t=this.isExpanded(e);this.setExpanded(!t,e),this.storeState();var o=this.checkIfAllSectionsOpen();this.updateOpenAllButton(o)},t.prototype.setExpanded=function(e,t){t.querySelector(".govuk-accordion__section-header-button").setAttribute("aria-expanded",e),e?t.classList.add("govuk-accordion__section--expanded"):t.classList.remove("govuk-accordion__section--expanded"),this.$module.className=this.$module.className},t.prototype.isExpanded=function(e){return e.classList.contains("govuk-accordion__section--expanded")},t.prototype.setHeaderAttributes=function(e,t){var o=e.querySelector(".govuk-accordion__section-header-button"),i=document.createElement("button");i.setAttribute("class",o.getAttribute("class")),i.setAttribute("aria-controls",this.moduleId+"-panel-"+(t+1));for(var n=0;n<o.childNodes.length;n++){var a=o.childNodes[n];o.removeChild(a),i.appendChild(a)}e.removeChild(o),e.appendChild(i);var s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width","16"),s.setAttribute("height","16"),s.setAttribute("viewBox","0 0 32 32"),s.setAttribute("class","govuk-accordion--icon"),s.innerHTML=' <path class="govuk-accordion--icon-open" d="M13.3721 -7.11581e-08L7.48837 5.84655L1.5814 -5.86546e-07L-6.9424e-08 1.58823L7.51163 9L15 1.61125L13.3721 -7.11581e-08Z"/><rect class="govuk-accordion--icon-close" x="1.58691" y="0.0893555" width="16.0371" height="2.16583" transform="rotate(45 1.58691 0.0893555)"/><rect class="govuk-accordion--icon-close" x="0.0966797" y="11.34" width="16.0371" height="2.16583" transform="rotate(-45 0.0966797 11.34)"/>',e.appendChild(s)},t.prototype.setOpenAllButtonAttributes=function(e){e.textContent="Open all",e.setAttribute("class","govuk-accordion__expand-all"),e.setAttribute("aria-expanded","false"),e.setAttribute("type","button")},t.prototype.openOrCloseAllSections=function(){var e=this,t=this.$sections,i=!("true"===e.$openAllButton.getAttribute("aria-expanded"));o(t,function(t){e.setExpanded(i,t)}),e.updateOpenAllButton(i)},t.prototype.updateOpenAllButton=function(e){var t=e?"Close all":"Open all";this.$openAllButton.setAttribute("aria-expanded",e),this.$openAllButton.textContent=t},t.prototype.checkIfAllSectionsOpen=function(){var e=this,t=this.$sections,i=this.$sections.length,n=0;return o(t,function(t){e.isExpanded(t)&&n++}),i===n};var i=function(){var e,t="this is the test string";try{return window.sessionStorage.setItem(t,t),e=window.sessionStorage.getItem(t)===t.toString(),window.sessionStorage.removeItem(t),e}catch(e){}};function n(e){this.$module=e,this.$navToggle=e.querySelector(".navigation__toggle"),this.$navItems=e.querySelectorAll(".navigation__list-item")}function a(e){this.$dropCookie=!0,this.$cookieDuration=365,this.$cookieName="CookieConsent",this.$cookieValue="true",this.$cookieBanner=e,this.$cookieBannerParent=this.$cookieBanner.parentNode,this.$cookieBannerContinue=document.querySelector(".cookiebanner__button--continue"),this.$cookieBannerClose=document.querySelector(".cookiebanner--close"),this.$cookieModal=document.getElementById("modal-cookiesettings"),this.$MarketingcookieName="MarketingConsent",this.$MarketingcookieValue="false",this.$Marketingcheckbox=document.getElementById("cbxMarketingConsent"),this.$AnalyticscookieName="AnalyticsConsent",this.$AnalyticscookieValue="true",this.$AnalyticsCheckbox=document.getElementById("cbxAnalyticsConsent")}function s(e){this.$trackingEnabled=null!=e,this.$DataLayer=e}function r(e,t){this.$module=e,this.$videoPlayerId=this.$module.dataset.videoplayerid,this.$videoUrl=this.$module.dataset.videourl,this.$player=null,this.$playerElement=null,this.$videoWrap=null,this.$playerClass=this.$module.dataset.playerclass,this.$videoPlayerTemplate='<div class="video-player__wrap"><a href="#" class="video-player__close" id="close-{videoPlayerId}" tabindex="0">Close</a><div class="video-player plyr__video-embed js-player visually-hidden" id="{videoPlayerId}"><div class="video-player--inner-wrap"><iframe src="{videoUrl}" allowfullscreen allowtransparency allow="autoplay"></iframe></div></div></div>',this.$trackingEnabled=null!=t,this.$gtmDataLayer=t,this.$gtm=null,this.$playingTimer=null,this.$playingTimerTimespan=5e3}function l(e,t){var o=Math.pow(10,t||0);return Math.round(e*o)/o}function c(e){this.$module=e,this.$anchorLinks=e.querySelectorAll('a[href^="#"]')}function d(e,t){for(var o in t)if(t.hasOwnProperty(o)){var i=t[o];e=e.replace("(("+o+"))",i)}return e}function u(e){return window[e]}function h(){return u("MarkerClusterer")}function p(){return u("InfoBox")}function m(e){this.$module=e,this.$gmapApi=null,this.$map=null,null!=this.$module.dataset.lat&&null!=this.$module.dataset.lon&&(this.$center={lat:parseFloat(this.$module.dataset.lat),lon:parseFloat(this.$module.dataset.lon)}),this.$distance=this.$module.dataset.distance,this.$markers=new Array,this.$markersData=null,this.$MarkerDataUrl=this.$module.dataset.markerdataurl,this.$markerClusterer=null,this.$infoboxTemplate=this.$module.querySelector("[data-google-map-infobox-template]").innerHTML}function g(e,t){if(window.NodeList.prototype.forEach)return e.forEach(t);for(var o=0;o<e.length;o++)t.call(window,e[o],o,e)}t.prototype.storeState=function(){i()&&o(this.$sections,function(e){var t=!!e.querySelector("h2 [aria-controls]")&&e.querySelector("h2 [aria-controls]").getAttribute("aria-controls"),o=!!e.querySelector("h2 [aria-expanded]")&&e.querySelector("h2 [aria-expanded]").getAttribute("aria-expanded");!1===t&&console&&console.error(new Error("No aria controls present in accordion heading.")),!1===o&&console&&console.error(new Error("No aria expanded present in accordion heading.")),t&&o&&window.sessionStorage.setItem(t,o)})},t.prototype.readState=function(){i()&&o(this.$sections,function(e){var t,o=!!e.querySelector("h2 [aria-controls]")&&e.querySelector("h2 [aria-controls]").getAttribute("aria-controls");if(o&&(t=window.sessionStorage.getItem(o)),null!==t){var i="true"===t;this.setExpanded(i,e)}}.bind(this))},n.prototype.init=function(){this.$module&&(null!=this.$navToggle&&this.$navToggle.addEventListener("click",this.onToggleNav.bind(this,this.$navToggle)),function(e,t){if(window.NodeList.prototype.forEach)return e.forEach(t);for(var o=0;o<e.length;o++)t.call(window,e[o],o,e)}(this.$navItems,function(e,t){this.$subnavToggle=e.querySelector(".navigation__sub-menu-toggle"),null!=this.$subnavToggle&&this.$subnavToggle.addEventListener("click",this.onToggleSubNav.bind(this,e))}.bind(this)))},n.prototype.onToggleNav=function(){document.querySelector("body").classList.toggle("js-menu-open")},n.prototype.onToggleSubNav=function(e,t){t.preventDefault(),e.querySelector(".navigation__link--top-level").classList.toggle("sub-menu-open"),e.querySelector(".navigation__sub-menu").classList.toggle("js-show")},a.prototype.init=function(){null==this.checkCookie(this.$MarketingcookieName)&&this.createCookie(this.$MarketingcookieName,this.$MarketingcookieValue,this.$cookieDuration),null==this.checkCookie(this.$AnalyticscookieName)&&this.createCookie(this.$AnalyticscookieName,this.$AnalyticscookieValue,this.$cookieDuration),this.checkCookie(this.$cookieName)==this.$cookieValue?(this.removeBanner(),this.removeModal()):(this.showBanner(),this.$cookieBannerContinue.addEventListener("click",this.removeBannerEvent.bind(this,!0)),this.$cookieBannerClose.addEventListener("click",this.removeBannerEvent.bind(this,!1))),null!=this.$Marketingcheckbox&&null!=this.$AnalyticsCheckbox&&(this.$Marketingcheckbox.checked="true"===this.checkCookie(this.$MarketingcookieName),this.$AnalyticsCheckbox.checked="true"===this.checkCookie(this.$AnalyticscookieName))},a.prototype.removeBannerEvent=function(e,t){this.createCookie(this.$cookieName,this.$cookieValue,this.$cookieDuration),e&&(this.createCookie(this.$MarketingcookieName,"true",this.$cookieDuration),this.createCookie(this.$AnalyticscookieName,"true",this.$cookieDuration),this.removeModal()),this.removeBanner()},a.prototype.showBanner=function(){if(null!==this.$cookieBanner){var e=this.$cookieBanner.getAttribute("class").replace(" visually-hidden","");this.$cookieBanner.setAttribute("class",e)}},a.prototype.setChecked=function(e,t){var o=e.checked?"true":"false";this.createCookie(t,o,this.$cookieDuration)},a.prototype.createCookie=function(e,t,o){if(o){var i=new Date;i.setTime(i.getTime()+24*o*60*60*1e3);var n="; expires="+i.toGMTString()}else n="";this.$dropCookie&&(document.cookie=e+"="+t+n+"; path=/")},a.prototype.checkCookie=function(e){for(var t=e+"=",o=document.cookie.split(";"),i=0;i<o.length;i++){for(var n=o[i];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null},a.prototype.eraseCookie=function(e){this.createCookie(e,"",-1)},a.prototype.removeBanner=function(){null!==this.$cookieBanner&&this.$cookieBannerParent.removeChild(this.$cookieBanner),null!=this.$Marketingcheckbox&&this.$Marketingcheckbox.addEventListener("click",this.setChecked.bind(this,this.$Marketingcheckbox,this.$MarketingcookieName)),this.$AnalyticsCheckbox&&this.$AnalyticsCheckbox.addEventListener("click",this.setChecked.bind(this,this.$AnalyticsCheckbox,this.$AnalyticscookieName))},a.prototype.removeModal=function(){null!==this.$cookieModal&&this.$cookieBannerParent.removeChild(this.$cookieModal)},s.prototype.sendEvent=function(e,t){t.event=e;JSON.stringify(t);this.$DataLayer.push(t)},r.prototype.init=function(){if(this.$module){this.appendPlayer(),this.$playerElement=document.getElementById(this.$videoPlayerId),this.$videoWrap=this.$playerElement.parentNode,null!=this.$playerClass&&this.$videoWrap.classList.add(this.$playerClass),this.$player=new Plyr(this.$playerElement,{fullscreen:{enabled:!0}});var e="click";1==this.$player.touch&&(e="touchstart"),this.$module.addEventListener(e,this.play.bind(this)),this.$closeButton=document.getElementById("close-"+this.$videoPlayerId),this.$closeButton.addEventListener("click",this.close.bind(this)),this.$module.classList.add("js-video-player__ready"),this.$trackingEnabled&&(this.$gtm=new s(this.$gtmDataLayer),this.enableTrackingEvents())}},r.prototype.appendPlayer=function(){var e=this.$videoPlayerTemplate.replace(/{videoPlayerId}/g,this.$videoPlayerId).replace("{videoUrl}",this.$videoUrl);window.document.body.insertAdjacentHTML("beforeend",e)},r.prototype.close=function(e){this.$videoWrap.classList.remove("video-player__playing"),this.$module.classList.remove("js-video-player__playing"),this.$player.stop(),e.preventDefault()},r.prototype.play=function(e){var t=this;this.$videoWrap.classList.add("video-player__playing"),this.$module.classList.add("js-video-player__playing"),this.$player.play(),window.addEventListener("keydown",function(e){if("Escape"==e.key||"Esc"==e.key)return t.close(e),e.preventDefault(),!1},!0),this.$closeButton.focus(),e.preventDefault()},r.prototype.enableTrackingEvents=function(){var e=this;this.$player.on("play",function(t){0==e.$player.currentTime?e.sendEvent("video_started"):e.sendEvent("video_play"),e.$playingTimer=setInterval(e.sendPlayingEvent.bind(e,e),e.$playingTimerTimespan)}),this.$player.on("ended",function(t){e.sendEvent("video_ended"),clearInterval(e.$playingTimer)}),this.$player.on("pause",function(t){e.sendEvent("video_paused"),clearInterval(e.$playingTimer)})},r.prototype.sendEvent=function(e){var t={currentTimestamp:l(this.$player.currentTime,1),totalVideoPlayed:l(this.$player.currentTime/this.$player.duration,2),totalVideoDuration:this.$player.duration,videoId:this.$player.embed.getVideoData().video_id};this.$gtm.sendEvent(e,t)},r.prototype.sendPlayingEvent=function(e){e.sendEvent("video_playing")},c.prototype.smoothScroll=function(e,t,o,i){const n={easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e}},a=window.pageYOffset,s="now"in window.performance?performance.now():(new Date).getTime(),r=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),l=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight,c=("number"==typeof e?e:e.offsetTop)-150,d=Math.round(r-c<l?r-l:c);if("requestAnimationFrame"in window==!1)return window.scroll(0,d),void(i&&i());!function e(){const r="now"in window.performance?performance.now():(new Date).getTime(),l=Math.min(1,(r-s)/t),c=n[o](l);window.scroll(0,Math.ceil(c*(d-a)+a)),window.pageYOffset!==d?requestAnimationFrame(e):i&&i()}()},c.prototype.init=function(e,t){var o=this;this.$anchorLinks.forEach(function(e){var t=document.querySelector(e.hash);null!=t&&e.addEventListener("click",o.smoothScroll.bind(this,t,500,"easeInOutQuart",null))})},m.prototype.init=function(e){this.$markersData=e,null!=this.$center?this.$center=new google.maps.LatLng(this.$center.lat,this.$center.lon):this.$center=new google.maps.LatLng(52.4387,1.6478),this.$map=new google.maps.Map(this.$module,{center:this.$center,scrollwheel:!1,zoom:10,maxZoom:14,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},mapTypeControl:!1,streetViewControl:!1}),null!=this.$MarkerDataUrl&&this.GetResults(),null!=this.$distance&&this.addRadius(this.$distance)},m.prototype.initMarkers=function(e){let t=this.$markersData;this.setMarkersOnMap(t)},m.prototype.addRadius=function(e){var t=new google.maps.Circle({strokeColor:"#111111",strokeOpacity:.8,strokeWeight:2,fillColor:"#111111",fillOpacity:.35,map:this.$map,center:this.$center,radius:1609*e});this.$map.fitBounds(t.getBounds())},m.prototype.addMarker=function(e,t,o,i){void 0===i&&(i=!0);var n={Title:e,Latitude:t,Longitude:o,Location:{Latitude:t,Longitude:o}};this.setMarkerOnMap(n,i)},m.prototype.setMarkersOnMap=function(e,t){void 0===t&&(t=!0);new google.maps.Size(45,40),new google.maps.Size(45,40),new google.maps.Point(0,0),new google.maps.Point(0,0);for(var o=0,i=e.length;o<i;o++)this.setMarkerOnMap(e[o],t);this.initMarkerClusterer(),google.maps.event.trigger(this.$map,"resize")},m.prototype.setMarkerOnMap=function(e,t){void 0===t&&(t=!0);var o={position:new google.maps.LatLng(e.Location.Latitude,e.Location.Longitude),map:this.$map};p&&t&&(o.infobox=this.getInfoBox(e));var i=new google.maps.Marker(o);if(p&&t){var n=this;i.addListener("click",function(){if(this.openInfoBox&&(this.openInfoBox.close(),this.openInfoBox===i.infobox))this.openInfoBox=null;else{i.infobox.open(n.$map,i);var e=new google.maps.LatLng(i.position.lat(),i.position.lng());n.$map.panTo(e),this.openInfoBox=i.infobox}})}this.$markers.push(i)},m.prototype.getLatLngByPostcode=function(e){new google.maps.Geocoder},m.prototype.getInfoBox=function(e){var t=p(),o=this.$infoboxTemplate,i={Title:e.Title,ShortDescription:e.ShortDescription,Url:e.VacancyUrl},n=-250;return window.innerWidth<899&&(n=-200),new t({content:d(o,i),disableAutoPan:!1,maxWidth:"auto",pixelOffset:new google.maps.Size(n,-100),infoBoxClearance:new google.maps.Size(1,1),closeBoxMargin:"5px 5px 2px 2px",closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif"})},m.prototype.initMarkerClusterer=function(){if(null!=h){var e=h();this.$markerClusterer=new e(this.$map,this.$markers,{imagePath:"https://googlemaps.github.io/js-marker-clusterer/images/m"})}},m.prototype.GetResults=function(){var e=this,t=new XMLHttpRequest;t.open("GET",this.$MarkerDataUrl,!0),t.onload=function(){this.status>=200&&this.status<400&&(e.$markersData=JSON.parse(this.response).Results,e.initMarkers(e.$markersData))},t.onerror=function(){},t.send()},m.prototype.LoadMarkers=function(e){},e.initAll=function(){var e,o,i=window.dataLayer;e=function(){g(document.querySelectorAll('[data-module="navigation"]'),function(e){new n(e).init()});var e=document.querySelector('[data-module="cookieBanner"]');null!=e&&new a(e).init(),g(document.querySelectorAll('[data-module="accordion"]'),function(e){new t(e).init()}),g(document.querySelectorAll('[data-module="smoothScroll"]'),function(e){new c(e).init()}),g(document.querySelectorAll('[data-module="videoPlayer"]'),function(e){new r(e,i).init()})},o=window.onload,"function"!=typeof window.onload?window.onload=e:window.onload=function(){o(),e()}},e.initMaps=function(){null!=window.google&&null!=window.google.maps&&g(document.querySelectorAll('[data-module="googleMaps"]'),function(e){new m(e).init()})},e.Accordion=t,e.Navigation=n,e.CookieBanner=a,e.VideoPlayer=r,e.GoogleMaps=m},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("DASFrontend",["exports"],t):t(e.DASFrontend={});
